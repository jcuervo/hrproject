$(document).ready(function(){function a(a,b,c){reg_exp=new RegExp(b),a.replace(reg_exp,c)}$(".add_fields").live("click",function(a){a.preventDefault();var b=$(this).data("association"),c=$(this).data("associations"),d=$(this).data("template"),e=$(this).data("association-insertion-position"),f=$(this).data("association-insertion-node"),g=$(this).data("insertion-callback"),h=new RegExp("\\[new_"+b+"\\]","g"),i=new RegExp("_new_"+b+"_","g"),j=(new Date).getTime(),k="["+j+"]",l="_"+j+"_",m=d.replace(h,"["+j+"]");m==d&&(h=new RegExp("\\[new_"+c+"\\]","g"),i=new RegExp("_new_"+c+"_","g"),m=d.replace(h,"["+j+"]")),m=m.replace(i,l),f?f=f=="this"?$(this):$(f):f=$(this).parent();var n=$(m);e=="after"?f.after(n):f.before(n),g&&g.call(n)}),$(".remove_fields.dynamic").live("click",function(a){a.preventDefault(),$(this).closest(".nested-fields").remove()}),$(".remove_fields.existing").live("click",function(a){a.preventDefault(),$(this).prev("input[type=hidden]").val("1"),$(this).closest(".nested-fields").hide()})})